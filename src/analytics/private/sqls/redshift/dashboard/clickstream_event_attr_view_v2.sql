CREATE MATERIALIZED VIEW {{scheam}}.clickstream_event_attr_view_v2
BACKUP YES
SORTKEY (event_timestamp) 
AUTO REFRESH NO
AS
SELECT
  e.event_timestamp,
  e.event_id,
  e.user_pseudo_id,
  e.session_id,
  e.event_time_msec,
  e.event_name,
  e.platform,
  event_value,
  event_value_currency,
  event_bundle_sequence_id,
  ingest_time_msec,
  device_mobile_brand_name,
  device_mobile_model_name,
  device_manufacturer,
  device_carrier,
  device_network_type,
  device_operating_system,
  device_operating_system_version,
  device_vendor_id,
  device_advertising_id,
  device_system_language,
  device_time_zone_offset_seconds,
  device_ua_browser,
  device_ua_browser_version,
  device_ua_device,
  device_ua_device_category,
  device_screen_width,
  device_screen_height,
  device_viewport_width,
  device_viewport_height,
  geo_continent,
  geo_sub_continent,
  geo_country,
  geo_region,
  geo_metro,
  geo_city,
  geo_locale,
  traffic_source_source,
  traffic_source_medium,
  traffic_source_campaign,
  traffic_source_content,
  traffic_source_term,
  traffic_source_campaign_id,
  traffic_source_clid_platform,
  traffic_source_clid,
  traffic_source_channel_group,
  traffic_source_category,
  user_first_touch_time_msec,
  app_package_id,
  app_id,
  app_version,
  app_title,
  app_install_source,
  project_id,
  screen_name,
  screen_id,
  screen_unique_id,
  previous_screen_name,
  previous_screen_id,
  previous_screen_unique_id,
  page_referrer,
  page_referrer_title,
  page_title,
  page_url,
  page_url_path,
  hostname,
  latest_referrer,
  latest_referrer_host,
  app_start_is_first_time,
  previous_view_time_msec,
  previous_view_engagement_time_msec,
  entrances,
  previous_app_version,
  previous_os_version,
  search_key,
  search_term,
  outbound_link_classes,
  outbound_link_domain,
  outbound_link_id,
  outbound_link_url,
  outbound_link,
  user_engagement_time_msec,
  scroll_engagement_time_msec,
  sdk_error_code,
  sdk_error_message,
  sdk_exception_message,
  sdk_exception_stack,
  sdk_version,
  sdk_name,
  e.custom_parameters_json_str,
  e.session_duration,
  s.session_number,
  s.session_start_time_msec,
  session_source,
  session_medium,
  session_campaign,
  session_content,
  session_term,
  session_campaign_id,
  session_clid_platform,
  session_clid,
  session_channel_group,
  session_source_category
FROM {{scheam}}.event_v2 as e
JOIN {{scheam}}.session as s ON e.user_pseudo_id = s.user_pseudo_id AND e.session_id = s.session_id
;